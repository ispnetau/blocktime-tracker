{% extends "base.html" %}
{% block content %}


<h2 class="text-center">Technician Report</h2>

<form method="get" class="row g-3 mb-4">
  <div class="col-md-4">
    <label for="technician_id" class="form-label">Technician:</label>
    <select class="form-select" name="technician_id" id="technician_id">
      <option value="">Select a Technician</option>
      {% for tech in technicians %}
      <option value="{{ tech.id }}" {% if tech.id == selected_technician_id %}selected{% endif %}>
        {{ tech.first_name }} {{ tech.last_name }}
      </option>
      {% endfor %}
    </select>
  </div>

  <div class="col-md-3">
    <label for="start_date" class="form-label">Start Date:</label>
    <input type="date" class="form-control" name="start_date" id="start_date" value="{{ selected_start_date or '' }}">
  </div>

  <div class="col-md-3">
    <label for="end_date" class="form-label">End Date:</label>
    <input type="date" class="form-control" name="end_date" id="end_date" value="{{ selected_end_date or '' }}">
  </div>

  <div class="col-md-2 align-self-end">
    <button type="submit" class="btn btn-primary w-100">Generate</button>
  </div>
</form>

{% if total_hours is not none %}
<div class="alert alert-info">
  <strong>Total hours logged:</strong> {{ total_hours }} hrs
</div>
{% endif %}

<hr class="my-5">
<h2 class="text-center">Block Time Report</h2>

<form method="get" class="row g-3 mb-4">
  <input type="hidden" name="export" value="false">
  <div class="col-md-4">
    <label for="client_id" class="form-label">Client:</label>
    <select class="form-select" name="client_id" id="client_id" onchange="this.form.submit()">
      <option value="">Select Client</option>
      {% for client in clients %}
      <option value="{{ client.id }}" {% if client.id == selected_client_id %}selected{% endif %}>{{ client.name }}</option>
      {% endfor %}
    </select>
  </div>

  <div class="col-md-4">
    <label for="contract_id" class="form-label">Contract:</label>
    <select class="form-select" name="contract_id" id="contract_id">
      <option value="">Select Contract</option>
      {% for contract in contracts %}
      <option value="{{ contract.id }}" {% if contract.id == selected_contract_id %}selected{% endif %}>{{ contract.name }}</option>
      {% endfor %}
    </select>
  </div>

  <div class="col-md-4 align-self-end">
    <button type="submit" class="btn btn-primary w-100">View Tickets</button>
  </div>
</form>

{% if contract_tickets %}
  <form method="get">
    <input type="hidden" name="client_id" value="{{ selected_client_id }}">
    <input type="hidden" name="contract_id" value="{{ selected_contract_id }}">
    <input type="hidden" name="export" value="true">
    <button type="submit" class="btn btn-outline-success mb-3">Export CSV</button>
  </form>

  <table class="table table-striped">
    <thead>
      <tr>
        <th>Date</th>
        <th>Title</th>
        <th>Technician</th>
        <th>Hours Used</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      {% for ticket in contract_tickets %}
      <tr>
        <td>{{ ticket.date.strftime('%Y-%m-%d') }}</td>
        <td>{{ ticket.title }}</td>
        <td>{{ ticket.technician.first_name }} {{ ticket.technician.last_name }}</td>
        <td>{{ ticket.hours_used }}</td>
        <td>{{ ticket.description }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
{% endif %}

{% endblock %}
